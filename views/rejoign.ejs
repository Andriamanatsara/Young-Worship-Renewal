<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="icon" type="image/x-icon" href="/assets/img/Logo YWR 500px blanc.png">
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/assets/css/styles.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/rejoign.css">
    <script src="/assets/js/index.js"></script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-4 rejoign-left">
                <img src="assets/img/Mickael.jpg" alt="fond">
                <div class="left-content">
                    <a href="/" class="navbar-brand">
                        <img src="/assets/img/Logo YWR 500px blanc.png" alt="logo" width="150">
                    </a>
                    <div class="left-text translate">
                        <h1 class="fw-bold">Bienvenue</h1>
                        <p >Ensemble, grandissons dans la foi.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-8 rejoign-right">
                <div class="container">
                    <nav class="navbar navbar-light navbar-expand-md py-3 navbar-light">
                        <button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-3">
                            <span class="visually-hidden">Toggle navigation</span>
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navcol-3">
                            <ul class="navbar-nav me-auto mb-2 mb-lg-0 gap-2 fs-5">
                                <li class="nav-item">
                                    <a href="/" class="nav-link active">Accueil</a>
                                </li>
                                <li class="nav-item">
                                <a href="/membres" class="nav-link">Membres</a>
                                </li>
                                <li class="nav-item">
                                <a href="/#a_propos" class="nav-link">À propos</a>
                                </li>
                                <li class="nav-item">
                                <a href="#contact" class="nav-link">Contact</a>
                                </li>
                            </ul>
                            <% if (user) { %>
                                <div class="btn-group">
                                    <a href="/admin/tableau-de-bord" class="btn btn-light text-dark btn-sm btn-connect" role="button"><i class="bi bi-speedometer2"></i> Tableau de bord</a>
                                    
                                    <button type="button" class="btn btn-danger btn-connect btn-sm" title="Déconnexion" onclick="openConfirmationModal('Déconnecter')">
                                        <i class="fa fa-sign-out-alt"></i> <span class="d-none d-md-inline">Déconnexion</span>
                                      </button>
                                  </div>
                            <% } else { %>
                                <a href="/users/login" class="btn btn-success btn-connect" role="button">Se Connecter</a>
                            <% } %>
                        </div>
                    </nav>
                    <div class="container">
                        
                        <h2 class="fw-bold title"><small><%= user ? 'Ajouter un nouveau membre' : 'Rejoindre la communauté' %></small></h2>
                        <form enctype="multipart/form-data" id="memberForm" method="POST" action="">
                            <div class="row">
                                <div class="col-md-6 pe-3">
                                    <h5 class="p-3"><small>Champs obligatoires</small></h5>
                                    <div class="mb-3">
                                        <input type="text" class="form-control shadow" id="name" name="name" placeholder="Nom">
                                        <div class="text-danger" id="error-name" style="font-size: 12px;"></div> <!-- Erreur pour le nom -->
                                    </div>
                        
                                    <div class="mb-3">
                                        <input type="text" class="form-control shadow" id="surname" name="surname" placeholder="Prénom">
                                        <div class="text-danger" id="error-surname" style="font-size: 12px;"></div> <!-- Erreur pour le prénom -->
                                    </div>
                        
                                    <div class="mb-3">
                                        <input type="text" id="dateOfBirth" class="form-control shadow" placeholder="Date de naissance" onfocus="switchToDatePicker()" name="dateOfBirth"/>
                                        <div class="text-danger" id="error-dateOfBirth" style="font-size: 12px;"></div> 
                                        <script>
                                            function switchToDatePicker() {
                                                const input = document.getElementById('dateOfBirth');
                                                input.type = 'date';  // Change type pour afficher le sélecteur de date
                                            }
                                        </script>
                                    </div>
                        
                                    <div class="mb-3">
                                        <input type="text" class="form-control shadow" id="adress" name="adress" placeholder="Adresse">
                                        <div class="text-danger" id="error-adress" style="font-size: 12px;"></div> <!-- Erreur pour l'adresse -->
                                    </div>
                        
                                    <div class="mb-3">
                                        <input type="text" class="form-control shadow" id="phoneNumber" name="phoneNumber" placeholder="Téléphone">
                                        <div class="text-danger" id="error-phoneNumber" style="font-size: 12px;"></div> <!-- Erreur pour le téléphone -->
                                    </div>
                        
                                    <div class="mb-3">
                                        <select id="engagement" class="form-control shadow" name="engagement">
                                            <option value="" disabled selected>Sélectionnez un engagement</option>
                                            <option value="Chanteur">Chanteur</option>
                                            <option value="Danseur">Danseur</option>
                                            <option value="Media">Media</option>
                                            <option value="Messagier">Messagier</option>
                                            <option value="Intercesseur">Intercesseur</option>
                                            <option value="Logistique">Logistique</option>
                                        </select>
                                        <div class="text-danger" id="error-engagement" style="font-size: 12px;"></div> <!-- Erreur pour l'engagement -->
                                    </div>
                        
                                    <div class="mb-3">
                                        <input type="text" id="adhesionDate" class="form-control shadow" name="adhesionDate" placeholder="Date d'adhésion" onfocus="switchToDatePickerAdhesion()"/>
                                        <div class="text-danger" id="error-adhesionDate" style="font-size: 12px;"></div>
                                        <script>
                                            function switchToDatePickerAdhesion() {
                                                const input = document.getElementById('adhesionDate');
                                                input.type = 'date';
                                            }
                                        </script>
                                    </div>
                                </div>
                        
                                <div class="col-md-6">
                                    <h5 class="p-3"><small>Photo de profil</small></h5>
                                    <div class="d-flex justify-content-center">
                                        <label for="imageInput" class="preview-container" id="previewBox">
                                            <i class="fas fa-camera icon-camera" id="cameraIcon"></i>
                                            <img id="preview" src="" alt="Aperçu de l'image">
                                            <button type="button" class="remove-btn" id="removeImage">&times;</button>
                                            <div class="hover-text" id="hoverText">Ajouter une photo de profil</div>
                                        </label>
                                        <input type="file" id="imageInput" class="hidden-input" name="screenMember" accept="image/*">
                                    </div>
                                    <div id="error-screenMember" class="text-danger" style="font-size: 12px;"></div>
                                    
                                    <h5 class="p-3 "><small>Champs optionnels</small></h5>
                                    <div class="mb-3">
                                        <input type="text" class="form-control shadow" id="facebook" name="facebook" placeholder="Facebook">
                                        <div class="text-danger" id="error-facebook" style="font-size: 12px;"></div> <!-- Erreur pour Facebook -->
                                    </div>
                                    
                                    <div class="mb-3">
                                        <input type="email" class="form-control shadow" id="email" name="email" placeholder="Mail">
                                        <div class="text-danger" id="error-email" style="font-size: 12px;"></div> <!-- Erreur pour l'email -->
                                    </div>
                        
                                    <div class="mb-3">
                                        <button type="submit" class="btn btn-primary w-100"><%= user ? 'Nouveau membre' : 'Rejoindre' %></button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                
            </div>
        </div>
    </div>


    <%- include('./partials/footer.ejs') %>

      <% if (message) { %>
        <div class="popup alert alert-<%= message.type %> text-center" id="popupMessage" role="alert">
          <%= message.message %>
        </div>
     <% } %>
    
    <script src="assets/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
        const elements = document.querySelectorAll(".translate");
        const observer = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if(entry.isIntersecting){
              entry.target.classList.add('show');
              observer.unobserve(entry.target);
            }
          });
        });
  
        elements.forEach(element => observer.observe(element));
        observer.observe(translateX);
      </script>
  
      <script>
         const imageInput = document.getElementById('imageInput');
          const preview = document.getElementById('preview');
          const cameraIcon = document.getElementById('cameraIcon');
          const removeBtn = document.getElementById('removeImage');
          const hoverText = document.getElementById('hoverText');
  
          imageInput.addEventListener('change', function(event) {
              const file = event.target.files[0];
              if (file) {
                  const reader = new FileReader();
                  reader.onload = function(e) {
                      preview.src = e.target.result;
                      preview.style.display = "block";
                      cameraIcon.style.display = "none";
                      removeBtn.style.display = "flex";
                      hoverText.textContent = "Changer la photo de profil"; 
                  };
                  reader.readAsDataURL(file);
              }
          });
  
          removeBtn.addEventListener('click', function(event) {
              event.stopPropagation();
              preview.src = "";
              preview.style.display = "none";
              cameraIcon.style.display = "block";
              removeBtn.style.display = "none";
              hoverText.textContent = "Ajouter une photo de profil";
              imageInput.value = "";
          });
      </script>

<script>
    document.getElementById('memberForm').addEventListener('submit', function(event) {
    event.preventDefault();  // Empêcher l'envoi du formulaire pour valider avant

    const errorMessages = document.querySelectorAll('.text-danger');
    errorMessages.forEach(error => error.textContent = '');

    // Récupérer les valeurs des champs
    const name = document.getElementById('name').value.trim();
    const surname = document.getElementById('surname').value.trim();
    const dateOfBirth = document.getElementById('dateOfBirth').value.trim();
    const adress = document.getElementById('adress').value.trim();
    const phoneNumber = document.getElementById('phoneNumber').value.trim();
    const engagement = document.getElementById('engagement').value.trim();
    const adhesionDate = document.getElementById('adhesionDate').value.trim();
    const file = document.getElementById('imageInput').files[0];
    const email = document.getElementById('email').value.trim();
    const facebook = document.getElementById('facebook').value.trim();

    let isValid = true;

    // Validation des champs obligatoires
    if (!name) {
        document.getElementById('error-name').textContent = 'Le nom est requis';
        console.log("Nom invalide:", name); // Ajoute un log
        isValid = false;
    }
    if (!surname) {
        document.getElementById('error-surname').textContent = 'Le prénom est requis';
        console.log("Prénom invalide:", surname); // Ajoute un log
        isValid = false;
    }
    if (!dateOfBirth) {
        document.getElementById('error-dateOfBirth').textContent = 'La date de naissance est requise';
        console.log("Date de naissance invalide:", dateOfBirth); // Ajoute un log
        isValid = false;
    }
    if (!adress) {
        document.getElementById('error-adress').textContent = 'L\'adresse est requise';
        console.log("Adresse invalide:", adress); // Ajoute un log
        isValid = false;
    }
    if (!phoneNumber || !/^\+?(\d{1,3})?[-.\s]?\(?\d+\)?[-.\s]?\d+[-.\s]?\d+$/.test(phoneNumber)) {
        document.getElementById('error-phoneNumber').textContent = 'Numéro de téléphone invalide';
        console.log("Numéro de téléphone invalide:", phoneNumber); // Ajoute un log
        isValid = false;
    }
    if (!engagement) {
        document.getElementById('error-engagement').textContent = 'Sélectionnez un niveau d\'engagement';
        console.log("Engagement invalide:", engagement); // Ajoute un log
        isValid = false;
    }
    if (!adhesionDate) {
        document.getElementById('error-adhesionDate').textContent = 'La date d\'adhésion est requise';
        console.log("Date d'adhésion invalide:", adhesionDate); // Ajoute un log
        isValid = false;
    }
    if (!file) {
        document.getElementById('error-screenMember').textContent = 'Une photo est requise';
        console.log("Photo invalide:", file); // Ajoute un log
        isValid = false;
    }
    if (email && !/^\S+@\S+\.\S+$/.test(email)) {
        document.getElementById('error-email').textContent = 'Email invalide';
        console.log("Email invalide:", email); // Ajoute un log
        isValid = false;
    }

    console.log("isValid:", isValid);


    if(isValid){
        this.submit();
    }

});

</script>

</body>
</html>